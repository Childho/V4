<!-- 评价页面 - 底部弹窗样式 -->
<view class="evaluate-container">
  <!-- 遮罩层 -->
  <view class="mask {{show ? 'show' : ''}}" bindtap="closePage"></view>
  
  <!-- 评价弹窗主体 -->
  <view class="evaluate-popup {{show ? 'show' : ''}}">
    <!-- 顶部标题栏 -->
    <view class="popup-header">
      <view class="header-left">
        <button class="close-btn" bindtap="closePage">
          <text class="iconfont icon-close">✕</text>
        </button>
      </view>
      <view class="header-title">商品评价</view>
      <view class="header-right">
        <button class="submit-btn" bindtap="submitEvaluation" disabled="{{!canSubmit}}">
          发布
        </button>
      </view>
    </view>

    <!-- 商品信息 -->
    <view class="product-info">
      <image class="product-image" src="{{orderInfo.goods[0].image}}" mode="aspectFill"></image>
      <view class="product-details">
        <view class="product-name">{{orderInfo.goods[0].title}}</view>
        <view class="product-spec">{{orderInfo.goods[0].spec}}</view>
      </view>
    </view>

    <!-- 滚动区域 -->
    <scroll-view class="scroll-content" scroll-y="true">
      <!-- 星级评价 -->
      <view class="rating-section">
        <view class="section-title">总体评价</view>
        <view class="rating-container">
          <view class="stars">
            <view 
              wx:for="{{5}}" 
              wx:key="index"
              class="star {{rating > index ? 'active' : ''}}"
              data-rating="{{index + 1}}"
              bindtap="setRating"
            >
              <text class="star-icon">★</text>
            </view>
          </view>
          <view class="rating-text">{{ratingTexts[rating - 1] || '点击评分'}}</view>
        </view>
      </view>

      <!-- 标签快选 -->
      <view class="tags-section" wx:if="{{rating > 0}}">
        <view class="section-title">选择标签（可选）</view>
        <view class="tags-container">
          <view 
            wx:for="{{availableTags}}" 
            wx:key="index"
            class="tag-item {{selectedTags.includes(item) ? 'selected' : ''}}"
            data-tag="{{item}}"
            bindtap="toggleTag"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- 文字评价 -->
      <view class="text-section">
        <view class="section-title">
          写评价 
          <text class="optional">（选填）</text>
        </view>
        <textarea 
          class="text-input"
          placeholder="说说你的使用感受吧，分享给其他小伙伴参考~"
          value="{{textContent}}"
          bindinput="onTextInput"
          maxlength="{{maxTextLength}}"
          show-confirm-bar="{{false}}"
          auto-height
        ></textarea>
        <view class="text-counter">{{textContent.length}}/{{maxTextLength}}</view>
      </view>

      <!-- 图片/视频上传 -->
      <view class="media-section">
        <view class="section-title">
          上传图片/视频 
          <text class="optional">（选填）</text>
        </view>
        <view class="media-container">
          <!-- 已上传的媒体 -->
          <view 
            wx:for="{{uploadedMedia}}" 
            wx:key="index"
            class="media-item"
          >
            <image 
              wx:if="{{item.type === 'image'}}"
              class="media-preview"
              src="{{item.url}}"
              mode="aspectFill"
              bindtap="previewMedia"
              data-index="{{index}}"
            ></image>
            <view 
              wx:if="{{item.type === 'video'}}"
              class="video-preview"
              bindtap="previewMedia"
              data-index="{{index}}"
            >
              <image class="video-thumb" src="{{item.thumb}}" mode="aspectFill"></image>
              <view class="video-play-icon">▶</view>
            </view>
            <view class="media-delete" bindtap="deleteMedia" data-index="{{index}}">
              <text class="delete-icon">✕</text>
            </view>
          </view>
          
          <!-- 上传按钮 -->
          <view 
            wx:if="{{uploadedMedia.length < maxMediaCount}}"
            class="upload-btn"
            bindtap="chooseMedia"
          >
            <text class="upload-icon">+</text>
            <text class="upload-text">添加</text>
          </view>
        </view>
        <view class="media-tip">最多上传{{maxMediaCount}}张图片或1个视频</view>
      </view>

      <!-- 设置选项 -->
      <view class="settings-section">
        <!-- 匿名评价 -->
        <view class="setting-item">
          <view class="setting-label">
            <text class="setting-icon">👤</text>
            <text class="setting-title">匿名评价</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{isAnonymous}}"
            bindchange="toggleAnonymous"
            color="#FF6B35"
          />
        </view>
        
        <!-- 公开评价 -->
        <view class="setting-item">
          <view class="setting-label">
            <text class="setting-icon">🌐</text>
            <text class="setting-title">公开评价</text>
            <text class="setting-desc">其他用户可以看到您的评价</text>
          </view>
          <switch 
            class="setting-switch"
            checked="{{isPublic}}"
            bindchange="togglePublic"
            color="#FF6B35"
          />
        </view>
      </view>

      <!-- 底部安全区域 -->
      <view class="bottom-space"></view>
    </scroll-view>
  </view>
</view> 