<!-- æœç´¢ç»“æœé¡µé¢ -->
<view class="search-page">
  
  <!-- 1. é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-header" style="padding-top: {{statusBarHeight + 20}}rpx;">
    <!-- è¿”å›æŒ‰é’® -->
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    
    <!-- æœç´¢è¾“å…¥æ¡† -->
    <view class="search-input-container">
      <view class="search-input-box">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="ç¾½æ¯›çƒæ‹" 
          value="{{keyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          confirm-type="search"
        />
      </view>
    </view>
    
    <!-- æœç´¢æŒ‰é’® -->
    <view class="search-btn" bindtap="onSearchConfirm">
      <text>æœç´¢</text>
    </view>
  </view>

  <!-- 2. å•†å“åˆ†ç±»å¯¼èˆª -->
  <view class="category-tabs">
    <scroll-view class="category-scroll" scroll-x="true" show-scrollbar="false">
      <view class="category-list">
        <!-- å…¨éƒ¨åˆ†ç±» -->
        <view 
          class="category-item {{currentCategoryId === 0 ? 'active' : ''}}"
          bindtap="onCategoryTap"
          data-id="0"
        >
          <view class="category-icon">ğŸ·ï¸</view>
          <text class="category-name">å…¨éƒ¨</text>
        </view>
        
        <!-- å…·ä½“åˆ†ç±» -->
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-item {{currentCategoryId === item.id ? 'active' : ''}}"
          bindtap="onCategoryTap"
          data-id="{{item.id}}"
        >
          <view class="category-icon">{{item.icon}}</view>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 3. æ’åºç­›é€‰æ  -->
  <view class="filter-bar">
    <!-- æ’åºé€‰é¡¹ -->
    <view class="sort-section">
      <view 
        wx:for="{{sortOptions}}" 
        wx:key="type"
        class="sort-item {{item.active ? 'active' : ''}}"
        bindtap="onSortTap"
        data-type="{{item.type}}"
      >
        <text>{{item.name}}</text>
        <text class="sort-icon" wx:if="{{item.active}}">{{item.icon}}</text>
      </view>
    </view>
    
    <!-- ç­›é€‰æŒ‰é’® -->
    <view class="filter-btn" bindtap="showBrandFilter">
      <text class="filter-icon">âš™</text>
      <text>ç­›é€‰</text>
      <view class="filter-count" wx:if="{{selectedBrandIds.length > 0}}">{{selectedBrandIds.length}}</view>
    </view>
  </view>

  <!-- 4. å•†å“åˆ—è¡¨ -->
  <view class="product-container">
    <view class="product-grid">
      <view 
        wx:for="{{productList}}" 
        wx:key="id"
        class="product-card"
        bindtap="onProductTap"
        data-id="{{item.id}}"
      >
        <!-- å•†å“æ ‡ç­¾ -->
        <view class="product-badges" wx:if="{{item.tags}}">
          <text class="badge" wx:if="{{item.originalPrice}}">ç‰¹ä»·</text>
          <text class="badge new" wx:if="{{item.id <= 2}}">æ–°å“</text>
        </view>
        
        <!-- å•†å“å›¾ç‰‡ -->
        <image 
          class="product-image" 
          src="{{item.image}}" 
          mode="aspectFill"
          lazy-load="true"
        ></image>
        
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="product-info">
          <!-- å•†å“æ ‡é¢˜ -->
          <text class="product-title">{{item.title}}</text>
          
          <!-- ä»·æ ¼åŒºåŸŸ -->
          <view class="price-row">
            <text class="current-price">Â¥{{item.price}}</text>
            <text class="original-price" wx:if="{{item.originalPrice}}">Â¥{{item.originalPrice}}</text>
          </view>
          
          <!-- åº•éƒ¨ä¿¡æ¯ -->
          <view class="bottom-info">
            <view class="rating-sales">
              <text class="rating" wx:if="{{item.rating}}">â­ {{item.rating}}</text>
              <text class="sales">æœˆå”®{{item.sales}}+</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text class="loading-text">æ­£åœ¨æœç´¢ä¸­...</text>
    </view>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{loadingMore}}">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && productList.length > 0}}">
      <text>å·²åŠ è½½å…¨éƒ¨å•†å“</text>
    </view>
  </view>

  <!-- 6. ä¼˜åŒ–åçš„å“ç‰Œç­›é€‰å¼¹çª— -->
  <view class="brand-modal {{showBrandModal ? 'show' : ''}}" wx:if="{{showBrandModal}}">
    <!-- é®ç½©å±‚ -->
    <view class="modal-mask" bindtap="hideBrandFilter"></view>
    
    <!-- å¼¹çª—å†…å®¹ -->
    <view class="modal-content">
      <!-- å¼¹çª—å¤´éƒ¨ - ä¼˜åŒ–æ ·å¼ -->
      <view class="modal-header">
        <view class="header-left">
          <view class="modal-icon">ğŸ·ï¸</view>
          <text class="modal-title">é€‰æ‹©å“ç‰Œ</text>
        </view>
        <view class="modal-close" bindtap="hideBrandFilter">
          <text class="close-icon">âœ•</text>
        </view>
      </view>
      
      <!-- å·²é€‰ä¸­å“ç‰Œæ˜¾ç¤ºåŒº - æ–°å¢ -->
      <view class="selected-brands" wx:if="{{selectedBrandIds.length > 0}}">
        <view class="selected-title">
          <text>å·²é€‰ ({{selectedBrandIds.length}})</text>
        </view>
        <view class="selected-list">
          <view 
            wx:for="{{brands}}" 
            wx:key="id"
            wx:if="{{item.selected}}"
            class="selected-tag"
            bindtap="onBrandSelect"
            data-id="{{item.id}}"
          >
            <text class="tag-name">{{item.name}}</text>
            <text class="tag-close">âœ•</text>
          </view>
        </view>
      </view>
      
      <!-- å“ç‰Œç½‘æ ¼ - æ”¹ä¸ºç½‘æ ¼å¸ƒå±€ï¼Œä¸éœ€è¦æ»šåŠ¨ -->
      <view class="brand-grid-container">
        <view class="brand-grid-title">
          <text>å…¨éƒ¨å“ç‰Œ</text>
        </view>
        <view class="brand-grid">
          <view 
            wx:for="{{brands}}" 
            wx:key="id"
            class="brand-item {{item.selected ? 'selected' : ''}}"
            bindtap="onBrandSelect"
            data-id="{{item.id}}"
          >
            <!-- å“ç‰Œå›¾æ ‡ - æ–°å¢è§†è§‰å…ƒç´  -->
            <view class="brand-logo">
              <text class="brand-initial">{{item.name.charAt(0)}}</text>
            </view>
            
            <!-- å“ç‰Œåç§° -->
            <text class="brand-name">{{item.name}}</text>
            
            <!-- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨ -->
            <view class="brand-check {{item.selected ? 'checked' : ''}}">
              <text class="check-icon" wx:if="{{item.selected}}">âœ“</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- å¼¹çª—åº•éƒ¨ - ä¼˜åŒ–æŒ‰é’®æ ·å¼ -->
      <view class="modal-footer">
        <view class="footer-info" wx:if="{{selectedBrandIds.length > 0}}">
          <text class="info-text">å·²é€‰æ‹© {{selectedBrandIds.length}} ä¸ªå“ç‰Œ</text>
        </view>
        <view class="footer-buttons">
          <button class="btn-reset" bindtap="resetBrandFilter">
            <text class="btn-icon">ğŸ”„</text>
            <text>é‡ç½®</text>
          </button>
          <button class="btn-confirm" bindtap="confirmBrandFilter">
            <text class="btn-icon">âœ“</text>
            <text>ç¡®å®š</text>
          </button>
        </view>
      </view>
    </view>
  </view>
  
</view> 