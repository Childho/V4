<!-- 购物车页面结构 -->
<view class="cart-container">
  <!-- 顶部区域：管理按钮 -->
  <view class="cart-header">
    <view class="header-title">购物车</view>
    <view class="manage-btn" bindtap="toggleManageMode">
      {{isManageMode ? '完成' : '管理'}}
    </view>
  </view>

  <!-- 商品列表区域 -->
  <scroll-view class="cart-content" scroll-y="{{true}}">
    <!-- 空购物车提示 -->
    <view wx:if="{{cartList.length === 0}}" class="empty-cart">
      <image class="empty-icon" src="/assets/icons/empty-cart.png"></image>
      <text class="empty-text">购物车还是空的，快去添加商品吧~</text>
      <button class="go-shopping-btn" bindtap="goToMall">去逛逛</button>
    </view>

    <!-- 商品列表 -->
    <view wx:else class="cart-list">
      <view wx:for="{{cartList}}" wx:key="id" class="cart-item">
        <!-- 商品选择复选框 -->
        <view class="item-checkbox" bindtap="toggleItemSelect" data-index="{{index}}">
          <icon class="checkbox-icon" type="{{item.selected ? 'success' : 'circle'}}" size="20" color="{{item.selected ? '#4169e1' : '#ccc'}}"></icon>
        </view>

        <!-- 商品信息区域 -->
        <view class="item-content">
          <!-- 商品图片 -->
          <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
          
          <!-- 商品详情 -->
          <view class="item-details">
            <view class="item-name">{{item.name}}</view>
            <!-- 规格选择 - 点击可修改 -->
            <view class="item-spec" bindtap="openSpecsPopup" data-index="{{index}}">
              <text>{{item.spec}}</text>
              <text class="spec-arrow">></text>
            </view>
            <view class="item-price">¥{{item.price}}</view>
            
            <!-- 数量选择器 -->
            <view wx:if="{{!isManageMode}}" class="quantity-selector">
              <view class="quantity-btn decrease-btn" bindtap="decreaseQuantity" data-index="{{index}}">-</view>
              <input class="quantity-input" type="number" value="{{item.quantity}}" bindinput="inputQuantity" data-index="{{index}}" />
              <view class="quantity-btn increase-btn" bindtap="increaseQuantity" data-index="{{index}}">+</view>
            </view>

            <!-- 管理模式下的删除按钮 -->
            <view wx:if="{{isManageMode}}" class="delete-item-btn" bindtap="deleteItem" data-index="{{index}}">删除</view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部操作区域 -->
  <view wx:if="{{cartList.length > 0}}" class="cart-footer">
    <!-- 全选区域 -->
    <view class="select-all" bindtap="toggleSelectAll">
      <icon class="checkbox-icon" type="{{allSelected ? 'success' : 'circle'}}" size="20" color="{{allSelected ? '#4169e1' : '#ccc'}}"></icon>
      <text class="select-all-text">全选</text>
    </view>

    <!-- 金额明细区域 -->
    <view wx:if="{{!isManageMode}}" class="price-summary">
      <view class="total-price">
        <text class="price-label">合计：</text>
        <text class="price-value">¥{{totalPrice}}</text>
      </view>
      <view wx:if="{{discountAmount > 0}}" class="discount-info">
        <text class="discount-text">优惠：-¥{{discountAmount}}</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-btn">
      <button wx:if="{{!isManageMode}}" class="checkout-btn" bindtap="goToCheckout" disabled="{{selectedCount === 0}}">
        结算({{selectedCount}})
      </button>
      <button wx:else class="delete-btn" bindtap="deleteSelectedItems" disabled="{{selectedCount === 0}}">
        删除({{selectedCount}})
      </button>
    </view>
  </view>

  <!-- 规格选择弹窗 -->
  <view class="specs-popup" wx:if="{{showSpecsPopup}}">
    <view class="popup-mask" bindtap="closeSpecsPopup"></view>
    <view class="popup-content">
      <view class="popup-header">
        <image class="popup-product-image" src="{{currentItem.image}}" mode="aspectFill"></image>
        <view class="popup-product-info">
          <view class="popup-product-price">¥{{currentItem.price}}</view>
          <view class="popup-product-name">{{currentItem.name}}</view>
          <view class="popup-selected-specs">已选：{{selectedSpecs}}</view>
        </view>
        <view class="popup-close" bindtap="closeSpecsPopup">×</view>
      </view>
      
      <view class="popup-specs">
        <view class="popup-specs-item" wx:for="{{specOptions}}" wx:key="name">
          <view class="popup-specs-title">{{item.name}}</view>
          <view class="popup-specs-options">
            <view 
              class="popup-specs-option {{optionItem.selected ? 'selected' : ''}} {{optionItem.disabled ? 'disabled' : ''}}" 
              wx:for="{{item.options}}" 
              wx:for-item="optionItem"
              wx:key="value"
              bindtap="selectSpecOption"
              data-group-index="{{index}}"
              data-option-index="{{optionIndex}}"
              wx:for-index="optionIndex"
            >
              {{optionItem.value}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="popup-quantity">
        <view class="popup-quantity-title">数量</view>
        <view class="popup-quantity-control">
          <view class="quantity-minus {{currentItem.quantity <= 1 ? 'disabled' : ''}}" bindtap="popupDecreaseQuantity">-</view>
          <input class="quantity-input" type="number" value="{{currentItem.quantity}}" disabled />
          <view class="quantity-plus" bindtap="popupIncreaseQuantity">+</view>
        </view>
      </view>
      
      <view class="popup-btns">
        <button class="popup-confirm-btn" bindtap="confirmSpecsChange">确认修改</button>
      </view>
    </view>
  </view>
</view> 