<!-- 我的订单页面 -->
<view class="order-page">
  <!-- tab导航栏 -->
  <view class="tab-bar">
    <scroll-view class="tab-scroll" scroll-x="true">
      <view class="tab-list">
        <view 
          wx:for="{{tabs}}" 
          wx:key="id"
          class="tab-item {{currentTab === index ? 'active' : ''}}"
          data-index="{{index}}"
          bindtap="onTabChange"
        >
          {{item.name}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 订单列表 -->
  <view class="order-content">
    <!-- 空状态 -->
    <view wx:if="{{!loading && orderList.length === 0}}" class="empty-state">
      <view class="empty-icon">📦</view>
      <text class="empty-text">暂无相关订单</text>
      <text class="empty-desc">快去下单吧~</text>
    </view>

    <!-- 订单列表 -->
    <view wx:else class="order-list">
      <view 
        wx:for="{{orderList}}" 
        wx:key="id"
        class="order-item"
        data-order-id="{{item.id}}"
        bindtap="onOrderDetailClick"
      >
        <!-- 订单头部 -->
        <view class="order-header">
          <view class="order-info">
            <text class="order-id">订单号：{{item.id}}</text>
            <text class="order-time">{{item.createTime}}</text>
          </view>
          <view class="order-status {{item.status}}">{{item.statusText}}</view>
        </view>

        <!-- 商品列表 -->
        <view class="goods-list">
          <view 
            wx:for="{{item.goods}}" 
            wx:for-item="goods"
            wx:key="id"
            class="goods-item"
            data-goods-id="{{goods.id}}"
            catchtap="onGoodsClick"
          >
            <image class="goods-image" src="{{goods.image}}" mode="aspectFill"></image>
            <view class="goods-info">
              <text class="goods-title">{{goods.title}}</text>
              <text class="goods-spec">{{goods.spec}}</text>
              <view class="goods-price-quantity">
                <text class="goods-price">¥{{goods.price}}</text>
                <text class="goods-quantity">×{{goods.quantity}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- 物流信息 -->
        <view wx:if="{{item.logistics.company}}" class="logistics-info">
          <text class="logistics-text">{{item.logistics.company}} {{item.logistics.trackingNo}}</text>
          <text class="logistics-status">{{item.logistics.status}}</text>
        </view>

        <!-- 订单金额 -->
        <view class="order-amount">
          <text class="amount-label">共{{item.goods.length}}件商品 实付：</text>
          <text class="amount-value">¥{{item.totalAmount}}</text>
        </view>

        <!-- 操作按钮区域 -->
        <view class="order-actions">
          <!-- 待付款状态 -->
          <block wx:if="{{item.status === 'unpaid'}}">
            <button 
              class="action-btn cancel" 
              data-order-id="{{item.id}}"
              catchtap="onCancelOrder"
            >取消订单</button>
            <button 
              class="action-btn primary" 
              data-order-id="{{item.id}}"
              catchtap="onPayOrder"
            >立即付款</button>
          </block>

          <!-- 待发货状态 -->
          <block wx:elif="{{item.status === 'shipped'}}">
            <button 
              class="action-btn default" 
              data-order-id="{{item.id}}"
              catchtap="onUrgeShipping"
            >催发货</button>
            <button 
              class="action-btn primary" 
              data-order-id="{{item.id}}"
              catchtap="onLogisticsClick"
            >查看物流</button>
          </block>

          <!-- 待收货状态 -->
          <block wx:elif="{{item.status === 'shipping'}}">
            <button 
              class="action-btn default" 
              data-order-id="{{item.id}}"
              catchtap="onLogisticsClick"
            >查看物流</button>
            <button 
              class="action-btn primary" 
              data-order-id="{{item.id}}"
              catchtap="onConfirmReceive"
            >确认收货</button>
          </block>

          <!-- 待评价状态 -->
          <block wx:elif="{{item.status === 'completed'}}">
            <button 
              class="action-btn default" 
              data-order="{{item}}"
              catchtap="onBuyAgain"
            >再次购买</button>
            <button 
              class="action-btn primary" 
              data-order-id="{{item.id}}"
              catchtap="onGoEvaluate"
            >去评价</button>
          </block>

          <!-- 退款中状态 -->
          <block wx:elif="{{item.status === 'refunding'}}">
            <button 
              class="action-btn default" 
              data-order-id="{{item.id}}"
              catchtap="onLogisticsClick"
            >查看物流</button>
            <button 
              class="action-btn primary" 
              data-order-id="{{item.id}}"
              catchtap="onRefundDetail"
            >退款详情</button>
          </block>

          <!-- 通用操作：删除订单 -->
          <button 
            wx:if="{{item.status === 'completed' || item.status === 'cancelled'}}"
            class="action-btn delete" 
            data-order-id="{{item.id}}"
            catchtap="onDeleteOrder"
          >删除订单</button>
        </view>
      </view>
    </view>

    <!-- 加载更多 -->
    <view wx:if="{{loading}}" class="loading">
      <text>加载中...</text>
    </view>
    
    <view wx:elif="{{!hasMore && orderList.length > 0}}" class="no-more">
      <text>没有更多订单了</text>
    </view>
  </view>
</view> 