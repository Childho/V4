<view class="coupon-page">
  <!-- é¡¶éƒ¨tabåˆ‡æ¢ -->
  <view class="tab-container">
    <view class="tab-wrapper">
      <view 
        class="tab-item {{currentTab === index ? 'active' : ''}}"
        wx:for="{{tabs}}" 
        wx:key="id"
        data-index="{{index}}"
        bindtap="switchTab"
      >
        {{item.name}}
      </view>
    </view>
  </view>

  <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
  <view class="coupon-list">
    <!-- ä¼˜æƒ åˆ¸å¡ç‰‡ -->
    <view 
      class="coupon-item {{item.status === 4 ? 'expiring' : ''}}"
      wx:for="{{couponList}}" 
      wx:key="id"
    >
      <!-- å·¦ä¾§é‡‘é¢åŒºåŸŸ -->
      <view class="coupon-left">
        <view class="amount-wrapper">
          <!-- æ»¡å‡åˆ¸æ˜¾ç¤º -->
          <view wx:if="{{item.type === 1}}" class="amount-section">
            <text class="currency">Â¥</text>
            <text class="amount">{{item.amount}}</text>
          </view>
          <!-- æŠ˜æ‰£åˆ¸æ˜¾ç¤º -->
          <view wx:elif="{{item.type === 2}}" class="discount-section">
            <text class="discount">{{item.amount}}</text>
            <text class="discount-text">æŠ˜</text>
          </view>
          <!-- å…é‚®åˆ¸æ˜¾ç¤º -->
          <view wx:else class="free-shipping">
            <text class="free-text">å…é‚®</text>
          </view>
          
          <!-- ä½¿ç”¨æ¡ä»¶ -->
          <view class="condition" wx:if="{{item.minAmount > 0}}">
            æ»¡{{item.minAmount}}å¯ç”¨
          </view>
          <view class="condition" wx:else>
            æ— é—¨æ§›
          </view>
        </view>
      </view>

      <!-- å³ä¾§ä¿¡æ¯åŒºåŸŸ -->
      <view class="coupon-right">
        <!-- ä¼˜æƒ åˆ¸æ ‡é¢˜ -->
        <view class="coupon-title">{{item.title}}</view>
        
        <!-- é€‚ç”¨èŒƒå›´ -->
        <view class="coupon-scope">é€‚ç”¨èŒƒå›´ï¼š{{item.scope}}</view>
        
        <!-- æœ‰æ•ˆæœŸ -->
        <view class="coupon-time">
          æœ‰æ•ˆæœŸï¼š{{item.startTime}} è‡³ {{item.endTime}}
        </view>
        
        <!-- å³å°†è¿‡æœŸæé†’ï¼ˆå³å°†è¿‡æœŸçŠ¶æ€æ˜¾ç¤ºï¼‰ -->
        <view class="expire-warning" wx:if="{{item.status === 4}}">
          âš ï¸ å³å°†è¿‡æœŸï¼Œè¯·å°½å¿«ä½¿ç”¨
        </view>
        
        <!-- ä¼˜æƒ åˆ¸æè¿° -->
        <view class="coupon-desc">{{item.description}}</view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="coupon-actions">
          <!-- ä»è®¢å•ç¡®è®¤é¡µé¢æ¥çš„ï¼Œå¯ä½¿ç”¨çŠ¶æ€æ˜¾ç¤ºé€‰æ‹©æŒ‰é’® -->
          <view 
            wx:if="{{item.status === 1 && fromPage === 'order-confirm'}}" 
            class="select-btn"
            data-index="{{index}}"
            bindtap="selectCoupon"
          >
            é€‰æ‹©
          </view>
          
          <!-- ä»è®¢å•ç¡®è®¤é¡µé¢æ¥çš„ï¼Œå³å°†è¿‡æœŸçŠ¶æ€ä¹Ÿå¯ä»¥é€‰æ‹© -->
          <view 
            wx:elif="{{item.status === 4 && fromPage === 'order-confirm'}}" 
            class="select-btn warning"
            data-index="{{index}}"
            bindtap="selectCoupon"
          >
            é€‰æ‹©ä½¿ç”¨
          </view>
          
          <!-- å¯ä½¿ç”¨çŠ¶æ€çš„æŒ‰é’®ï¼ˆéè®¢å•ç¡®è®¤é¡µé¢ï¼‰ -->
          <view 
            wx:elif="{{item.status === 1 && fromPage !== 'order-confirm'}}" 
            class="use-btn"
            data-index="{{index}}"
            bindtap="showUseCouponModal"
          >
            ç«‹å³ä½¿ç”¨
          </view>
          
          <!-- å³å°†è¿‡æœŸçŠ¶æ€çš„æŒ‰é’®ï¼ˆéè®¢å•ç¡®è®¤é¡µé¢ï¼‰ -->
          <view 
            wx:elif="{{item.status === 4 && fromPage !== 'order-confirm'}}" 
            class="use-btn warning"
            data-index="{{index}}"
            bindtap="showUseCouponModal"
          >
            èµ¶ç´§ä½¿ç”¨
          </view>
          
          <!-- å³å°†è¿‡æœŸçŠ¶æ€çš„æ ‡ç­¾ï¼ˆå±•ç¤ºç”¨ï¼‰ -->
          <view wx:elif="{{item.status === 4}}" class="status-tag expiring-tag">
            å³å°†è¿‡æœŸ
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{couponList.length === 0 && !loading}}">
      <image class="empty-icon" src="/assets/icons/empty-coupon.svg"></image>
      <view class="empty-text">{{emptyText}}</view>
      <view class="empty-tip">å¿«å»é¢†å–ä¼˜æƒ åˆ¸å§ï½</view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ®æç¤º -->
    <view class="no-more" wx:if="{{!hasMore && couponList.length > 0}}">
      æ²¡æœ‰æ›´å¤šäº†ï½
    </view>
  </view>

  <!-- ä½¿ç”¨ä¼˜æƒ åˆ¸ç¡®è®¤å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showUseModal}}" bindtap="hideUseCouponModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <view class="modal-title">ç¡®è®¤ä½¿ç”¨ä¼˜æƒ åˆ¸</view>
        <view class="modal-close" bindtap="hideUseCouponModal">Ã—</view>
      </view>
      
      <view class="modal-body" wx:if="{{currentCoupon}}">
        <view class="coupon-preview">
          <view class="preview-amount">
            <text wx:if="{{currentCoupon.type === 1}}">Â¥{{currentCoupon.amount}}</text>
            <text wx:elif="{{currentCoupon.type === 2}}">{{currentCoupon.amount}}æŠ˜</text>
            <text wx:else>å…é‚®</text>
          </view>
          <view class="preview-title">{{currentCoupon.title}}</view>
        </view>
        
        <view class="confirm-text">
          ç¡®è®¤è¦ä½¿ç”¨è¿™å¼ ä¼˜æƒ åˆ¸å—ï¼Ÿä½¿ç”¨åå°†æ— æ³•æ’¤é”€ã€‚
        </view>
        
        <!-- å³å°†è¿‡æœŸçš„ç‰¹åˆ«æé†’ -->
        <view class="expire-confirm-warning" wx:if="{{currentCoupon.status === 4}}">
          ğŸ”” æ­¤ä¼˜æƒ åˆ¸å³å°†è¿‡æœŸï¼Œå»ºè®®å°½å¿«ä½¿ç”¨ï¼
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="cancel-btn" bindtap="hideUseCouponModal">å–æ¶ˆ</view>
        <view class="confirm-btn" bindtap="confirmUseCoupon">ç¡®è®¤ä½¿ç”¨</view>
      </view>
    </view>
  </view>
</view> 