<!-- 限时秒杀页面主容器 -->
<view class="seckill-container">
  
  <!-- 1. 自定义顶部导航栏 -->
  <view class="custom-nav-bar">
    <view class="nav-back" bindtap="goBack">
      <image class="back-icon" src="/assets/icons/arrow-left.svg" mode="aspectFit"></image>
    </view>
    <view class="nav-title">限时秒杀</view>
    <view class="nav-placeholder"></view>
  </view>

  <!-- 2. 搜索栏区域 -->
  <view class="search-section">
    <view class="search-bar">
      <view class="search-input-wrapper">
        <image class="search-icon" src="/assets/icons/search.svg" mode="aspectFit"></image>
        <input 
          class="search-input" 
          type="text" 
          placeholder="搜索秒杀商品" 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
        />
      </view>
      <button class="search-btn" bindtap="onSearchConfirm">搜索</button>
    </view>
  </view>

  <!-- 3. 品牌筛选区域 -->
  <view class="brand-filter-section">
    <!-- 品牌筛选标题区域 -->
    <view class="brand-filter-header">
      <view class="filter-title-wrapper">
        <image class="filter-icon" src="/assets/icons/tag.svg" mode="aspectFit"></image>
        <text class="filter-title">品牌筛选</text>
      </view>
    </view>
    
    <!-- 品牌筛选标签区域 -->
    <view class="brand-tags-container">
      <!-- 第一行：全部按钮和默认显示的品牌 -->
      <view class="brand-row">
        <!-- 全部按钮（具有展开功能） -->
        <view 
          class="brand-item {{selectedBrand === 'all' ? 'active' : ''}} all-brand" 
          bindtap="onAllBrandToggle"
        >
          全部
          <image 
            class="expand-icon {{brandsExpanded ? 'expanded' : ''}}" 
            src="/assets/icons/arrow-down.svg" 
            mode="aspectFit"
          ></image>
        </view>
        
        <!-- 默认显示的品牌 -->
        <view 
          class="brand-item {{selectedBrand === item.key ? 'active' : ''}}" 
          wx:for="{{defaultBrands}}" 
          wx:key="key"
          bindtap="onBrandSelect" 
          data-brand="{{item.key}}"
          wx:if="{{item.key !== 'all'}}"
        >
          {{item.name}}
        </view>
      </view>
      
      <!-- 第二行：展开时显示的额外品牌 -->
      <view class="brand-row extra-brands {{brandsExpanded ? 'show' : 'hide'}}" wx:if="{{extraBrands.length > 0}}">
        <view 
          class="brand-item {{selectedBrand === item.key ? 'active' : ''}}" 
          wx:for="{{extraBrands}}" 
          wx:key="key"
          bindtap="onBrandSelect" 
          data-brand="{{item.key}}"
        >
          {{item.name}}
        </view>
      </view>
    </view>
  </view>

  <!-- 4. 秒杀商品列表 -->
  <view class="products-section">
    <scroll-view scroll-y class="products-scroll" enable-flex="true">
      <!-- 商品列表 -->
      <view class="products-list">
        <view 
          class="product-item" 
          wx:for="{{filteredProducts}}" 
          wx:key="id"
          bindtap="goToProductDetail" 
          data-id="{{item.id}}"
        >
          <!-- 商品图片区域 -->
          <view class="product-image-wrapper">
            <image class="product-image" src="{{item.imageUrl}}" mode="aspectFill"></image>
            <view class="seckill-label">限时</view>
          </view>
          
          <!-- 商品信息区域 -->
          <view class="product-info">
            <!-- 品牌和标题 -->
            <view class="product-header">
              <text class="product-brand">{{item.brand}}</text>
              <text class="product-title">{{item.title}}</text>
            </view>
            
            <!-- 标签区域 -->
            <view class="tags-section">
              <view class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</view>
            </view>
            
            <!-- 价格和倒计时区域 -->
            <view class="price-countdown-section">
              <!-- 价格区域 -->
              <view class="price-section">
                <text class="current-price">¥{{item.seckillPrice}}</text>
                <text class="original-price">¥{{item.originalPrice}}</text>
              </view>
              
              <!-- 倒计时区域 -->
              <view class="countdown">
                <text class="countdown-time" data-end-time="{{item.endTime}}" data-id="{{item.id}}">
                  {{item.countdownText}}
                </text>
              </view>
            </view>
            
            <!-- 销量信息 -->
            <view class="sales-info">
              <text class="sales-count">已售{{item.soldCount}}件</text>
            </view>
          </view>
          
          <!-- 抢购按钮 -->
          <view class="buy-section">
            <view 
              class="buy-btn {{item.stock > 0 ? 'active' : 'disabled'}}" 
              bindtap="onBuyNow" 
              data-id="{{item.id}}"
            >
              {{item.stock > 0 ? '抢' : '售罄'}}
            </view>
          </view>
        </view>
      </view>
      
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{filteredProducts.length === 0}}">
        <image class="empty-icon" src="/assets/icons/empty-box.svg" mode="aspectFit"></image>
        <text class="empty-text">暂无相关商品</text>
      </view>
      
      <!-- 底部占位，防止被悬浮按钮遮挡 -->
      <view class="bottom-placeholder"></view>
    </scroll-view>
  </view>
</view>

<!-- 右下角悬浮购物车按钮 -->
<view class="floating-cart" bindtap="goToCart">
  <image class="cart-icon" src="/assets/icons/cart-white.svg" mode="aspectFit"></image>
  <!-- 购物车数量角标 -->
  <view class="cart-badge" wx:if="{{cartCount > 0}}">
    <text class="badge-text">{{cartCount > 99 ? '99+' : cartCount}}</text>
  </view>
</view>

<!-- 加载遮罩 -->
<view class="loading-mask" wx:if="{{isLoading}}">
  <view class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view> 