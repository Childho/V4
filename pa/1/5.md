-- 限时折扣商品表
CREATE TABLE `flash_sale_product` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ID，主键',
  `activity_id` bigint NOT NULL COMMENT '活动ID，关联flash_sale表',
  `product_id` bigint NOT NULL COMMENT '商品ID，关联product表',
  `flash_price` decimal(10,2) NOT NULL COMMENT '活动价格',
  `stock` int NOT NULL COMMENT '活动库存',
  `sales_volume` int DEFAULT 0 COMMENT '已售数量',
  `max_purchase` int DEFAULT 1 COMMENT '每人限购数量',
  `status` tinyint DEFAULT 1 COMMENT '状态：0禁用，1启用',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_activity_product` (`activity_id`,`product_id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_status` (`status`),
  FOREIGN KEY (`activity_id`) REFERENCES `flash_sale` (`id`),
  FOREIGN KEY (`product_id`) REFERENCES `product` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='限时折扣商品表';

-- ----------------------------
-- 评论相关表
-- ----------------------------

-- 商品评论表
CREATE TABLE `product_review` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '评论ID，主键',
  `user_id` bigint NOT NULL COMMENT '用户ID，关联user表',
  `order_id` bigint NOT NULL COMMENT '订单ID，关联order_master表',
  `order_detail_id` bigint NOT NULL COMMENT '订单明细ID，关联order_detail表',
  `product_id` bigint NOT NULL COMMENT '商品ID，关联product表',
  `rating` tinyint NOT NULL COMMENT '评分：1-5分',
  `content` text NOT NULL COMMENT '评论内容',
  `status` tinyint DEFAULT 1 COMMENT '状态：0待审核，1已通过，2已拒绝',
  `is_anonymous` tinyint DEFAULT 0 COMMENT '是否匿名：0否，1是',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '评论时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_product_id` (`product_id`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`id`),
  FOREIGN KEY (`order_id`) REFERENCES `order_master` (`id`),
  FOREIGN KEY (`order_detail_id`) REFERENCES `order_detail` (`id`),
  FOREIGN KEY (`product_id`) REFERENCES `product` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='商品评论表';

-- 评论图片表
CREATE TABLE `review_image` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '图片ID，主键',
  `review_id` bigint NOT NULL COMMENT '评论ID，关联product_review表',
  `image_url` varchar(255) NOT NULL COMMENT '图片URL',
  `sort_order` int DEFAULT 0 COMMENT '排序值',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_review_id` (`review_id`),
  FOREIGN KEY (`review_id`) REFERENCES `product_review` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='评论图片表';

-- ----------------------------
-- 系统设置相关表
-- ----------------------------

-- 系统配置表
CREATE TABLE `system_config` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '配置ID，主键',
  `config_key` varchar(100) NOT NULL COMMENT '配置键',
  `config_value` text NOT NULL COMMENT '配置值',
  `config_group` varchar(100) DEFAULT 'default' COMMENT '配置分组',
  `config_desc` varchar(255) DEFAULT NULL COMMENT '配置描述',
  `config_type` tinyint DEFAULT 1 COMMENT '配置类型：1文本，2数字，3布尔，4JSON，5数组',
  `status` tinyint DEFAULT 1 COMMENT '状态：0禁用，1启用',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_config_key` (`config_key`),
  KEY `idx_config_group` (`config_group`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';

-- 轮播图表
CREATE TABLE `banner` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '轮播图ID，主键',
  `title` varchar(100) DEFAULT NULL COMMENT '标题',
  `image_url` varchar(255) NOT NULL COMMENT '图片URL',
  `link_type` tinyint DEFAULT 1 COMMENT '链接类型：1商品，2分类，3自定义链接，4无链接',
  `link_value` varchar(255) DEFAULT NULL COMMENT '链接值，根据链接类型存储商品ID、分类ID或URL',
  `sort_order` int DEFAULT 0 COMMENT '排序值，值越小越靠前',
  `status` tinyint DEFAULT 1 COMMENT '状态：0禁用，1启用',
  `start_time` datetime DEFAULT NULL COMMENT '开始时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_sort_order` (`sort_order`),
  KEY `idx_status` (`status`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_end_time` (`end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='轮播图表';