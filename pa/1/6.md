-- 广告表
CREATE TABLE `advertisement` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '广告ID，主键',
  `ad_name` varchar(100) NOT NULL COMMENT '广告名称',
  `ad_position` varchar(50) NOT NULL COMMENT '广告位置',
  `image_url` varchar(255) NOT NULL COMMENT '图片URL',
  `link_type` tinyint DEFAULT 1 COMMENT '链接类型：1商品，2分类，3自定义链接，4无链接',
  `link_value` varchar(255) DEFAULT NULL COMMENT '链接值，根据链接类型存储商品ID、分类ID或URL',
  `status` tinyint DEFAULT 1 COMMENT '状态：0禁用，1启用',
  `start_time` datetime DEFAULT NULL COMMENT '开始时间',
  `end_time` datetime DEFAULT NULL COMMENT '结束时间',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_ad_position` (`ad_position`),
  KEY `idx_status` (`status`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_end_time` (`end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='广告表';

-- ----------------------------
-- 支付相关表
-- ----------------------------

-- 支付记录表
CREATE TABLE `payment_record` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '支付记录ID，主键',
  `order_id` bigint NOT NULL COMMENT '订单ID，关联order_master表',
  `payment_sn` varchar(50) NOT NULL COMMENT '支付流水号',
  `payment_type` tinyint NOT NULL COMMENT '支付方式：1微信支付，2支付宝，3货到付款',
  `amount` decimal(10,2) NOT NULL COMMENT '支付金额',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '支付状态：1待支付，2支付成功，3支付失败，4已关闭',
  `transaction_id` varchar(100) DEFAULT NULL COMMENT '第三方支付交易号',
  `payment_time` datetime DEFAULT NULL COMMENT '支付时间',
  `callback_time` datetime DEFAULT NULL COMMENT '回调时间',
  `callback_data` text COMMENT '回调数据',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_payment_sn` (`payment_sn`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_status` (`status`),
  FOREIGN KEY (`order_id`) REFERENCES `order_master` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='支付记录表';

-- 退款记录表
CREATE TABLE `refund_record` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '退款记录ID，主键',
  `refund_application_id` bigint NOT NULL COMMENT '退款申请ID，关联refund_application表',
  `refund_sn` varchar(50) NOT NULL COMMENT '退款流水号',
  `refund_amount` decimal(10,2) NOT NULL COMMENT '退款金额',
  `status` tinyint NOT NULL DEFAULT 1 COMMENT '退款状态：1待退款，2退款中，3退款成功，4退款失败',
  `transaction_id` varchar(100) DEFAULT NULL COMMENT '第三方退款交易号',
  `refund_time` datetime DEFAULT NULL COMMENT '退款时间',
  `callback_time` datetime DEFAULT NULL COMMENT '回调时间',
  `callback_data` text COMMENT '回调数据',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_refund_sn` (`refund_sn`),
  KEY `idx_refund_application_id` (`refund_application_id`),
  KEY `idx_status` (`status`),
  FOREIGN KEY (`refund_application_id`) REFERENCES `refund_application` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='退款记录表';

-- ----------------------------
-- 会员相关表
-- ----------------------------

-- 会员等级表
CREATE TABLE `member_level` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '等级ID，主键',
  `level_name` varchar(50) NOT NULL COMMENT '等级名称',
  `level_value` int NOT NULL COMMENT '等级值',
  `min_points` int NOT NULL COMMENT '最低积分',
  `max_points` int DEFAULT NULL COMMENT '最高积分，null表示无限',
  `discount_rate` decimal(5,2) DEFAULT 100.00 COMMENT '折扣率，例如95.00表示95折',
  `description` varchar(255) DEFAULT NULL COMMENT '等级描述',
  `status` tinyint DEFAULT 1 COMMENT '状态：0禁用，1启用',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_level_value` (`level_value`),
  KEY `idx_min_points` (`min_points`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会员等级表';

-- 积分记录表
CREATE TABLE `points_log` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '记录ID，主键',
  `user_id` bigint NOT NULL COMMENT '用户ID，关联user表',
  `order_id` bigint DEFAULT NULL COMMENT '订单ID，关联order_master表',
  `points` int NOT NULL COMMENT '积分数量，正数表示增加，负数表示减少',
  `balance` int NOT NULL COMMENT '积分余额',
  `reason` varchar(255) NOT NULL COMMENT '积分变动原因',
  `expire_time` datetime DEFAULT NULL COMMENT '积分过期时间，null表示永不过期',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_order_id` (`order_id`),
  KEY `idx_create_time` (`create_time`),
  FOREIGN KEY (`user_id`) REFERENCES `user` (`id`),
  FOREIGN KEY (`order_id`) REFERENCES `order_master` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='积分记录表';